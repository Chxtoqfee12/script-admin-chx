-- Services
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer

-- Variables
local invisible = false
local speedBoosted = false
local defaultSpeed = 16
local boostedSpeed = 48
local ghost = nil
local realChar = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()

if not realChar.PrimaryPart then
    realChar.PrimaryPart = realChar:WaitForChild("HumanoidRootPart")
end

-- Function: set transparency


local function setTransparency(character, transparency)
    for _, part in pairs(character:GetDescendants()) do
        if part:IsA("BasePart") or part:IsA("Decal") then
            part.Transparency = transparency
        end
    end
end

local function toggleInvisibility()
    invis_on = not invis_on
    sound:Play()
    if invis_on then
        local savedpos = game.Players.LocalPlayer.Character.HumanoidRootPart.CFrame
        wait()
        game.Players.LocalPlayer.Character:MoveTo(Vector3.new(-25.95, 84, 3537.55))
        wait(.15)
        local Seat = Instance.new('Seat', game.Workspace)
        Seat.Anchored = false
        Seat.CanCollide = false
        Seat.Name = 'invischair'
        Seat.Transparency = 1
        Seat.Position = Vector3.new(-25.95, 84, 3537.55) -- Fixed typo in position
        local Weld = Instance.new("Weld", Seat)
        Weld.Part0 = Seat
        Weld.Part1 = game.Players.LocalPlayer.Character:FindFirstChild("Torso") or game.Players.LocalPlayer.Character.UpperTorso
        wait()
        Seat.CFrame = savedpos
        setTransparency(game.Players.LocalPlayer.Character, 0.5)
        game.StarterGui:SetCore("SendNotification", {
            Title = "Invis (on)",
            Duration = 3,
            Text = "STATUS:"
        })
    else
        local invisChair = workspace:FindFirstChild('invischair')
        if invisChair then
            invisChair:Destroy()
        end
        setTransparency(game.Players.LocalPlayer.Character, 0)
        game.StarterGui:SetCore("SendNotification", {
            Title = "Invis (off)",
            Duration = 3,
            Text = "STATUS:"
        })
    end
end

-- Toggle Speed
local function toggleSpeed()
    local humanoid = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid")
    if not humanoid then return end
    speedBoosted = not speedBoosted
    humanoid.WalkSpeed = speedBoosted and boostedSpeed or defaultSpeed
end

-- Update Ghost position
RunService.RenderStepped:Connect(function()
    if invisible and ghost and realChar and realChar.PrimaryPart then
        ghost:SetPrimaryPartCFrame(realChar.PrimaryPart.CFrame)
    end
end)

-- Reset on respawn
LocalPlayer.CharacterAdded:Connect(function(char)
    realChar = char
    invisible = false
    speedBoosted = false
    char:WaitForChild("Humanoid").WalkSpeed = defaultSpeed
end)

-- GUI
local player = LocalPlayer
local screenGui = Instance.new("ScreenGui", player:WaitForChild("PlayerGui"))
local frame = Instance.new("Frame", screenGui)
frame.Size = UDim2.new(0, 120, 0, 130)
frame.Position = UDim2.new(0.5, -60, 0.5, -65)
frame.BackgroundColor3 = Color3.fromRGB(50,50,50)
frame.Active = true
frame.Draggable = true

local invisBtn = Instance.new("TextButton", frame)
invisBtn.Size = UDim2.new(0,100,0,30)
invisBtn.Position = UDim2.new(0,10,0,10)
invisBtn.Text = "INVISIBLE"
invisBtn.TextScaled = true
invisBtn.BackgroundColor3 = Color3.fromRGB(0,170,255)
invisBtn.TextColor3 = Color3.fromRGB(255,255,255)

local speedBtn = Instance.new("TextButton", frame)
speedBtn.Size = UDim2.new(0,100,0,30)
speedBtn.Position = UDim2.new(0,10,0,50)
speedBtn.Text = "SPEED BOOST"
speedBtn.TextScaled = true
speedBtn.BackgroundColor3 = Color3.fromRGB(255,0,0)
speedBtn.TextColor3 = Color3.fromRGB(255,255,255)

local closeBtn = Instance.new("TextButton", frame)
closeBtn.Size = UDim2.new(0,20,0,20)
closeBtn.Position = UDim2.new(1,-25,0,5)
closeBtn.Text = "X"
closeBtn.TextSize = 18
closeBtn.BackgroundColor3 = Color3.fromRGB(255,123,0)
closeBtn.TextColor3 = Color3.fromRGB(255,255,255)

-- Подписка на события
toggleButton.MouseButton1Click:Connect(toggleInvisibility)
speedButton.MouseButton1Click:Connect(toggleSpeedBoost)
closeButton.MouseButton1Click:Connect(function()
    frame.Visible = false
end)

-- Reset speed when character respawns
player.CharacterAdded:Connect(function(character)
    isSpeedBoosted = false
    local humanoid = character:WaitForChild("Humanoid")
    humanoid.WalkSpeed = defaultSpeed
    speedButton.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
end)
